<div ng-controller="OrchestratorLocationResourcesTemplateCtrl as ctrl">
  <div ng-show="!showCatalog" class="row" style="margin-top: 10px">
    <div class="col-md-12">
      <span>{{'ORCHESTRATORS.LOCATIONS.RESOURCES.TYPE' | translate}}: </span>
      <select ng-model="selectedConfigurationResourceType"
              ng-options="type.elementId for type in resourcesTypes">
      </select>
      <button ng-class="{'active': applyFilter}" ng-click="applyFilter = !applyFilter" class="btn btn-default btn-sm"><i class="fa fa-filter"></i> {{'COMMON.FILTER' | translate}}
      </button>
      <button class="btn btn-primary btn-sm" ng-click="addResourceTemplate()"><i class="fa fa-plus"></i> {{'COMMON.ADD' | translate}}</button>
    </div>
  </div>
  <div class="row" style="margin-top: 10px">
    <div class="col-md-6">
      <table class="table table-hover table-bordered" alien-droppable drag-data="" drag-on-drop="addResourceTemplate(data)">
        <thead>
          <tr>
            <th></th>
            <th>{{'COMMON.NAME' | translate}}</th>
            <th>{{'COMMON.TYPE' | translate}}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="template in resourcesTemplates | orderBy:'name'"
              ng-click="selectTemplate(template)"
              class="clickable"
              ng-class="{'warning': selectedResourceTemplate == template}"
              ng-if="!applyFilter || template.template.type == selectedConfigurationResourceType.elementId">
            <td ng-init="nodeIcon = getIcon(template.template.type)">
              <i ng-if="!nodeIcon" class="fa fa-cogs fa-3x"></i>
              <img ng-if="nodeIcon" ng-src="img?id={{nodeIcon}}&quality=QUALITY_32">
            </td>
            <td>{{template.name}}</td>
            <td>{{template.template.type}}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="col-md-6" ng-if="selectedResourceTemplate">
      <div class="well">
        <span id='closeNodeTemplateDetails' class="btn btn-default btn-xs pull-right close-btn-panel" ng-click="selectTemplate(null)">
              <i class="fa fa-remove close-panel"></i>
        </span>
        <orchestrator-location-resource-template resource-template="selectedResourceTemplate"
                                                 resource-type="resourcesTypesMap[selectedResourceTemplate.template.type]"
                                                 resource-capability-types="context.locationResources.capabilityTypes"
                                                 dependencies="context.location.dependencies"
                                                 is-editable="true"
                                                 is-property-editable="isPropertyEditable()"
                                                 on-delete="deleteResourceTemplate(resourceTemplate)"
                                                 on-update="updateLocationResource(propertyName, propertyValue)"
                                                 on-property-update="updateResourceProperty(propertyName, propertyValue)"
                                                 on-capability-property-update="updateResourceCapabilityProperty(capabilityName, propertyName, propertyValue)"
                                                 on-portability-property-update="updatePortabilityProperty(propertyName, propertyValue)">
        </orchestrator-location-resource-template>
      </div>
    </div>
    <div id="resource-catalog" ng-if="showCatalog" ng-show="!selectedResourceTemplate" class="col-md-6">
      <uib-tabset justified="true">
        <uib-tab index="0">
          <uib-tab-heading>
            {{ 'ORCHESTRATORS.LOCATIONS.RESOURCES.TYPE' | translate }}
          </uib-tab-heading>
          <ul class="list-group" style="overflow: auto; height: {{ dimensions.height }}px;">
            <li class="list-group-item media clickable-media favorite"
                ng-repeat="resource in ctrl.favorites | orderBy : ['-recommended', 'elementId']"
                alien-draggable drag-enabled="true" drag-data="resource">
              <div class="media-left" ng-init="nodeIcon = getIcon(resource.elementId)">
                <i ng-if="!nodeIcon" class="fa fa-cogs fa-3x"></i>
                <img ng-if="nodeIcon" ng-src="img?id={{nodeIcon}}&quality=QUALITY_64">
              </div>
              <div class="media-body">
                <small class="pull-right well well-sm"
                       ng-if="resource.recommended"
                       uib-tooltip="Recommended type from the orchestrator"
                       tooltip-placement="bottom"
                       tooltip-append-to-body="true">
                  <i class="fa fa-star" style="color:goldenrod"></i>
                </small>
                <h4 class="media-heading">{{ resource.elementId }}</h4>
                <p>
                  <b>{{'COMMON.SOURCE' | translate}}:</b> {{ resource.archiveName }}:{{ resource.archiveVersion }}
                </p>
              </div>
            </li>
          </ul>
        </uib-tab>
        <uib-tab index="1">
          <uib-tab-heading>
            <i class="icon-folder-open"></i> Catalog
          </uib-tab-heading>
          <alien-search-node-type
                  display-detail-pannel="false"
                  drag-and-drop-enabled="true"
                  default-filters="{'abstract':'F'}"
                  height-info="dimensions"
                  static-facets="staticFacets"
                  badges="badges">
          </alien-search-node-type>
        </uib-tab>
      </uib-tabset>
    </div>
  </div>
</div>